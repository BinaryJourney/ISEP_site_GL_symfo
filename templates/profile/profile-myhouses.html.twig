{% extends "base.html.twig" %}

{% block javascripts %}
    {{ parent() }}
    <script type="text/javascript" src="{{ asset('js/update_house_booking.js') }}"></script>
{% endblock %}

{% block body %}

    <div class="w-100 h-100 d-flex flex-column">

        {% if user.keyHouses %}
            <h3 class="mx-auto my-3">Liste de mes maisons</h3>
        {% else %}
            <h3 class="mx-auto my-3">Aucune maison rentr√©e</h3>
        {% endif %}

        {% for house in user.keyHouses.count != 0 %}
            <div class="container m-auto w-75 p-3">
                <div class="row">
                    <a class="col" style="font-weight: bold"
                       href="{{ path('app_house_detailed_view', {'id': house.id}) }}">{{ house.title }}</a>
                    <div class="col">{{ house.description }}</div>
                    <div class="col">{{ house.dateBegin | date('d-m-Y') }}</div>
                    <div class="col">{{ house.dateEnd | date('d-m-Y') }}</div>
                    <div class="col">{{ house.keyTypeAccommodationCapacity.capacity }}</div>
                    <div class="col">{{ house.keyListeVilleFrance.name ~ ' (' ~ house.keyListeVilleFrance.department ~ ')' }} </div>
                    <img class="col" src="{{ asset('uploads/images/' ~ house.imageFilename) }}">
                    <a class="btn btn-primary col" href="{{ path('app_house_edit', {'id': house.id}) }}">Edit</a>
                </div>
                {% for booking in house.keyBookings|sort((a, b) => a.dateBegin<=> b.dateBegin) %}
                    {% if booking.status.status == 'EN ATTENTE' or booking.status.status == 'ACCEPTE' or booking.status.status == 'ANNULE' %}
                        <div class="row ms-3">
                            <div class="col">{{ booking.keyBookerUserId.name ~ ' ' ~ booking.keyBookerUserId.surname }}</div>
                            <div class="col">{{ booking.dateBegin | date('d-m-Y') }}</div>
                            <div class="col">{{ booking.dateEnd | date('d-m-Y') }}</div>
                            <div class="col">{{ booking.status.status }}</div>
                            {% if booking.status.status == 'EN ATTENTE' %}
                                <a id="accept-{{ booking.id }}" class="btn btn-primary accept-booking col">Accept</a>
                                <a id="refuse-{{ booking.id }}" class="btn btn-danger refuse-booking col">Refuse</a>
                            {% endif %}
                            <a class="btn btn-primary col"
                               href="{{ path('app_messages', {'id': booking.keyBookerUserId.id}) }}">Envoyer un message
                                au demandeur</a>
                        </div>
                    {% endif %}
                {% endfor %}
            </div>
        {% endfor %}

    </div>

{% endblock %}